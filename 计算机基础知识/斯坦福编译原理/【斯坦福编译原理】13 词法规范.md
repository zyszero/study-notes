# 【斯坦福编译原理】13 词法规范

## 主题

如何用正则表达式构造完整的词法规范

## 基本的正则表达

![正则表达式.png](http://ww1.sinaimg.cn/large/007hWkdxgy1g7wq3ptfpgj30md0adgog.jpg)

## 如何设计一门语言的词法规则？

1. 为每一个词法写出正则表达式（write a rexp for the lexemes of each token class）

   ![Snipaste_2019-10-13_18-03-40.png](http://ww1.sinaimg.cn/large/007hWkdxgy1g7wqbnroqaj30nx0b30vs.jpg)

2. 构建一个可以匹配所有词法单元的复杂的正则表达式（Construct R, matching all lexemes for all tokens）

   R = keyword + Identifier + Number + ....

      = R1 + R2 + .....
   
3. 假设输入值为 X1...Xn，逐个进行检查，是否符合 X1...Xi  *ϵ*  L(R)

4. 如果符合，证明这个前缀X1 到 xi 在 L(Rj) 这个正则表达式所定义的语言中
   
5. 删除输入值 X1....Xi，回到步骤3，重复这些步骤
## 问题
1. “Maximal munch”（最长匹配）：当我们遇到输入值有两种不同的前缀，这两种都是有效的的词法单元，那么我们就应该选择最长的那个。例如：“==”，“=”和“==”两种词法单元，应选择“==”

2. 同样的字符串能够被解释为一种或两种不同的词法单元时，选用哪一个？例如：keyword = 'if' + 'else' + ...；identifier = letter(letter + digit+)*

   选择优先级高的，token class 有优先顺序，在定义词法规范的文件中，keyword 在 Identifier 之前
   
3. 如果输入值不符合词法规范的表达式语言，该怎么办？

   编写一个包含所有可能出现的错误字符串正则表达式，优先级放到最低，可以保证只有错误的字符串会被匹配到。

   

   

