# 个人以及项目介绍

## 自我介绍

面试官，您好！我叫钟宇声。18年毕业于仲恺农业工程学院，毕业后就职于广东省电子商务认证有限公司，担任后端开发工程师。就职以来，主要参与公司的两个核心产品的研发，分别是“数字证书认证系统”和“云密钥安全管理系统”，在“数字证书认证系统”这个产品中，负责证书注册系统的研发，以及其他子系统的部分模块的设计与开发，比如：证书签发模块、OCSP查询服务模块、 至今还在参与产品的版本迭代与维护，在团队中，属于主力开发人员之一。本人熟悉Java，熟练掌握Web开发技术，具备独自设计与研发小型系统的能力，希望应聘贵公司的Java开发工程师岗位。



## 项目介绍：

### NETCA数字证书认证系统

Situation - 在什么样的环境和背景下：

项目背景：公司是国内的CA机构，由于内部的CA运营平台依赖的基础设施，也就是数字证书认证系统，是购买自其他公司的产品，随着业务的发展，该基础设施预计在几年后便很难运营维护下去了，所以公司就打算结合多年运营CA的经验，以能够满足企业自建CA体系的需求为目标，自研“数字证书认证系统”，并作为公司的核心产品之一。

Task - 你要干什么样的事：

“NETCA数字证书认证系统”是由证书注册系统（RA）、证书认证系统（CA）、密钥管理系统（KM）和证书查询验证系统（LDAP、CRL和OCSP等）一套系统组建而成的。在整个产品初期，我参与了整套系统的架构设计以及技术选型，在产品研发阶段，则负责证书注册系统的搭研发以及其他系统部分核心模块的设计与开发。

Action - 你采取了什么样的行动和努力：

数字证书注册系统，主要负责证书申请者的信息录入、审核以及证书发放等工作，是CA的证书发放、管理的延伸。

整个系统由初始化系统、管理系统和证书接口服务三部分组成。三者我都以Spring Boot框架为基底，ORM框架采用MyBatis框架。

“1、采用Apahce Shiro权限框架，结合PKI认证技术，实现证书认证登录、操作记录不可抵赖以及权限控制等功能。”

管理系统的前端采用VUE框架来实现，后端的权限认证模块采用Apahce Shiro框架，并结合PKI认证技术，实现证书认证登录、操作记录的不可抵赖，以及权限控制。

实现细节：登录前，访问后端接口，获取一个随机数，前端通过调用用户的USBKey，对随机数等一些信息进行P7（PKCS#7）签名，将随机数、原文以及签名值发送到后台进行登录认证，后端将原文、签名值、随机数组成AuthenticationToken，然后在获取AuthenticationInfo，即调用doGetAuthenticationInfo会进行登录认证，即进行验签、校验证书有效期、校验证书链、然后通过证书校验用户是否存在、比对随机数操作，然后将操作员信息、签名值等组成SimpleAuthenticationInfo对象，来实现登录

权限认证 -》 基于角色来进行接口级别的权限控制



“2、负责 RA 对外证书接口服务的鉴权、防重放、限流等设计；对外提供不同消息协议的证书服务接口。”

如何对外提供不同的消息协议？

- 通过策略模式，实现CMP协议、JSON数据协议的HTTP（s）接口
  - 通过继承拓展Spring MVC的HandlerMethodArgumentResolver（方法参数解析器）和HandlerMethodReturnValueHandler（方法返回值处理器），结合拓展（继承）HttpMessageConverter，HttpMessageConverter内部对应不同的消息协议解析器，实现不同消息协议（不同的MediaType）对应的数据直接转换成业务对象

如何实现鉴权？

- 比对配置的通讯证书
- 验证签名
- 比对配置的开通接口

如何实现接口参数防篡改，接口调用防重放？

- 走HTTPS，数据加密传输
- 接口参数做签名，防篡改
- 基于时间戳（timestamp）和nonce(仅一次有效的随机字符串)的方案，来防止重放攻击
  - 单时间戳方案，缺点：在小于阈值的时间段内是可以进行重复请求的，该方案不能保证请求仅一次有效。
  - 单nonce（token）方案，缺点：nonce 会存储在缓存中，而且没有有效期设置，随着请求量的增加，缓存集合中 token 的数量会非常庞大，会占用系统的大量内存。

如何实现接口限流？

- 单体时，使用Guava中的RateLimiter -> 限流算法：令牌桶
- 分布式，通过使用Redis来实现，采用RRateLimiter
- 也可通过Nginx来实现限流
- 限流算法
  - 漏桶算法
  - 令牌桶算法
    - 所有请求在处理之前要拿到一个令牌，拿到令牌后，才能进行业务处理，处理完毕后，将令牌删除
    - 令牌根据限流大小，按照一定的速率往桶里添加令牌
    - 令牌桶会设置最大的令牌放置数，桶满时，新增的令牌就被丢弃或者拒绝
    - 令牌桶会有最低令牌限额，当令牌书到达最低时，请求处理完后，将不会删除令牌
  - 滑动时间窗口算法

"3、通过使用职责链设计模式来设计证书和 CRL 的签发流程，提升了签发流程的可拓展性。"

证书签发系统的核心模块。



“4、通过策略模式提升审计日志验证模块的拓展性，根据不同类型的日志，实现不同的日志验证策略。”

- 操作日志 - 直接简单的进行签名验证审计即可。
- 接口日志 - 不同消息协议下的接口日志，对应着不同的审计策略。



“5、OCSP 查询服务接口，预先产生 OCSP 响应数据，并将数据缓存至本地 GuavaCache 和 Redis，使用双缓存模式减少网络 I/O 请求，通过缓存有效降低 DB 压力，提升服务稳定性和并发量。”

压测数据：支持1.5k并发，平均响应以及中位数在1s内，95-99%均在1s内，压测时长120s，QPS预估1.7w。

存在“双写问题”，要怎么解决？



GuavaCache和Redis的缓存过期策略

- GuavaCache
- Redis



"6、日志上报模块设计实现使用了 Disruptor 作为缓冲上报的 buffer，通过 JMH 测试吞吐率比使 BlockingQueue 有 

20%的提升，并预研 Disruptor 相关底层，解决消费者的等待策略触发机器 CPU 满负载等问题。"

吞吐率上升的原因？Disruptor 底层实现？



消费者的等待策略触发机器 CPU 满负载，是指什么？

消费者在初始化的时候有策略，选的是BusySpinWaitStrategy自旋策略，会一直while循环判断，进行自旋，通过继承BusySpinWaitStrategy，重写等待方法，自旋达到一定阈值时，进入阻塞状态。



“7、系统间服务调用采用 gRPC+ProtoBuf 来实现，提升接口数据传输效率。 ”

gRPC是什么？



ProtoBuf 是什么？



Result - 最终得到了什么样的效果





### 云密钥安全管理系统

Situation - 在什么样的环境和背景下：

项目背景：

项目介绍：该系统主要目的是用于统一管理、维护用户密钥对的生命周期，向客户端应用、第三方系统提供签名验签、加解密、密钥授权等接口服务。主要保障相关服务操作的鉴权以及电子签名的合法性、不可抵赖性。



Task - 你要干什么样的事：

负责系统核心模块的设计与开发、落地系统高可用方案。



Action - 你采取了什么样的行动和努力：

“1、 通过使用桥接模式来设计实现用户身份认证模块，实现不同用户的多种认证方式，提升模块拓展性，避免继承层次的指数级爆炸。 ”

- 用户类型
  - 用户类型
  - 授权用户类型
- 认证方式
  - 证书密码
  - 证书密码+设备信息
  - 证书密码+短信验证码
  - 证书密码+刷脸
  - 证书密码+手机硬件信息+指纹



“2、 通过借鉴 JDBC 的设计，采用 Java SPI 机制来设计短信模块，实现不同客户接入不同短信平台的需求。”

- 抽象出一套通用的短信API，定义为一个短信接口

- 不同短信平台的对应着不同的短信实现

- 在每个独立的jar包中的src/main/resources/ 下建立 /META-INF/services 目录，新建短信接口文件（文件名得是接口的全限定名），文件里的内容就是短信接口的具体实现类的全限定名

- 然后通ServiceLoader来加载配置文件中指定的实现类。

  



“3、 通过自定义 MyBatis 插件+自定义注解，实现对用户敏感信息存储加密，读取解密的操作。”

- MyBatis的插件制作流程

“4、通过使用 Google Guava EventBus 建立系统内的事件发布/订阅总线机制。”

- Guava EventBus的实现原理



"5、 通过采用 ActiveMQ + MQTT，实现对移动端进行消息推送等功能。"

- MQ的基本知识
- ActiveMQ的基本概念
- 



“6、 通过使用线程池和 Redis 分布式锁，实现证书批量申请、续期、注销、下载等功能。”

- 线程池的概念，应用场景（八股文）。

- Redis如何实现分布式锁？
  - 单实例
  - 多实例



“7、 落地高可用方案：通过 Nginx + Keepalived 实现服务器双机热备；MySQL 采用半同步复制机制进行主主互备； Redis 采用“一主一从三哨兵”的形式，实现高可用。”



Result - 最终得到了什么样的效果：



三轮技术（QQ视频，34min）
自我介绍
为什么选择仲恺
物联网工程有哪些课程
操作系统学了哪些内容
为什么转Java，实习时是否有工资
平时是如何学习的

- 极客时间的专栏
- 国外出名的公开课 - CMU 15-445、MIT 6.824
- 书籍：《Effective Java》、《Clean Code》等
- 官方文档

多线程创建方式

- 继承Thread
- 实现Runnable接口
- Callable和FeatureTask
- 通过线程池来创建

创建十个线程，如何设计？明确场景

- 要使用线程池，明确CPU核心数
- 分场景，IO密集型还是CPU密集型（N是CPU核心数）
  - IO密集型的话，线程池大小应该是2N+1
  - CPU密集型，线程池大小应该是N+1
  - 混合场景，分别创建对应线程池
  - 最佳线程数目 = （（线程等待时间 + 线程 CPU 时间）/ 线程 CPU 时间 ）* CPU 数目 =》 最佳线程数目 = （线程等待时间与线程 CPU 时间之比 + 1）* CPU数目。

主线程如何等待十个线程执行结束？

- 通过使用CountdownLatch 来实现。
  - 在初始化CountdownLatch对象时，指定线程个数
  - 在每个线程run方法结束之前，调用CountdownLatch #countDown()方法
  - 在主线程结束前调用CountdownLatch #await()
  - 原理：AQS
- 需要重置计数的话，使用CyclicBarrier

子线程还在执行，主线程退出后程序是否结束

- 看子线程是用户线程还是守护线程
  - JVM会等待非守护线程完成后才关闭，JVM不会等待守护线程，所以如果子线程是用户线程，那么程序不结束。
  - 可以通过Thread#setDaemo(boolean on)来设置，true为守护线程，false为用户线程，需要在start方法前调用

主线程如何终止还在执行的子线程

- 定义一个退出标志，让子线程正常退出，即终止run方法
- 通过结合interrupt()和interrupted()方法来实现
- 通过stop()方法，但不推荐，已标识为过期方法。

了解Socket吗？

- Socket是TCP/IP协议的编程模型，通过一系列的API来控制操作系统的网络协议栈，从而建立TCP连接、发送或接受数据。
- 客户端Socket
  - new Socket
  - connect
  - send/recv
  - close
- 服务端Socket
  - new Socket
  - bind IP
  - listen port
  - accept
  - recv/send
  - close

BIO和NIO的区别？

- BIO：线程发起IO请求后，内核一直阻塞IO，直到缓冲区数据就绪后，在进一步操作。吃火锅，火锅店排队人很多，你在那里排队
- NIO：线程发起IO请求后，内核会立即返回一个error，线程可以去做其他事情，但需要定期轮询内核。同步指的是必须等待IO缓冲区内的数据就绪，而非阻塞指的是，用户线程不原地等待IO缓冲区，可以先做一些其他操作，但是要定时轮询检查IO缓冲区数据是否就绪

ArrayList和LinkedList的区别

- 都不能保证线程安全
- ArrayList底层是利用Object数组来实现的，LinkedList则是双向链表
- 由于底层数据结构不同，所以带来不同的区别，ArrayList支持快速随机访问，LinkedList 插入和删除方便。

说说HTTP

- HTTP，超文本传输协议，基于TCP/IP协议的应用层协议，是无状态协议，自身不对请求、响应之间的状态保存。

请求头有哪些常见属性

- Accept：客户端接收什么类型的响应
- Accept-Language
- Accept-Charset
- Referer：请求来源
- connection
- Cookie
- Host：
- User-Agent



如何排查OOM？

- JVM启动参数有配置“-XX:+HeapDumpOnOutOfMemoryError”，则直接使用MAT打开拿到的hprof文件进行分析，查看占用内存最大的是什么对象。
- 启动参数没有配置的情况下，则通过jmap手动抓取内存快照，但不推荐系统OOM时手工触发已经来不及，另外在生成dump文件时会占用系统内存资源，导致系统崩溃。



CPU高负载如何排查？

- top -c 将系统资源使用情况实时显示出来
- 利用 top -H -p 查看进程内占用cpu最高线程
- 利用 printf "%x \n" 将tid换为十六进制：xid。
- 再利用jstack（jstack | grep nid=0x -A 10）查询线程信息
- 分析问题，内存方面的问题，通过jmap导出内存快照
  - 利用MAT解析dump文件，分析内存问题



项目中Redis的Key如何设计

- 简单的配置缓存：不同类型的固定前缀::特定的key
- 数据库对象这种，则是 表名:主键列:主键值



说说MD5，有多少位
32位-1的二进制，F的二进制，4的二进制
说说最熟悉的项目
项目人数多少，前后端人数







抽象工厂模式、建造者模式
如何进行接口限流
HTTPS加密协议是什么，DES和RES是什么
说说UML
用时序图的方式说一下你的项目登录过程
OAuth2协议的过程
一个程序在服务器中CPU和占用内存很大，如何排查
住哪。。。







四轮研发部门负责人（QQ视频，18min）
自我介绍
介绍一下项目
从项目中学到了什么
认为在线教育跟电子政务有什么区别
对新技术和老技术的看法
离职原因
有什么问题想问的

