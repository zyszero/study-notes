# MySQL实战45讲

## 01 基础架构：一条SQL查询语句是如何执行的？

1. MySQL的框架有几个组件, 各是什么作用？

   客户端 -》 连接器 -》分析器 -》优化器 -》执行器 -》 存储引擎

   ​							   -》查询缓存

   ![](images/01-MySQL的逻辑架构图.png)

   连接器：负责与客户端建立连接，获取权限、维持和管理连接

   查询缓存：一种key-value缓存，之前执行过的SQL会被缓存在这，不建议使用查询缓存，因为查询缓存失效很频繁，弊大于利，MySQL 8.0开始，已经移除查询缓存。

   分析器：对SQL进行词法分析，识别SQL字符串中特定的字符串，比如select、from等，或者将字符T识别为表T，字符列名，识别为字段列。然后进行语法分析，根据语法规则校验词法分析的结果。

   优化器：在表里面有多个索引的时候，决定使用哪个索引；或者在一个语句有多表关联（join）的时候，决定各个表的连接顺序。

   执行器：执行语句，执行时会判断对被操作的表有无执行查询权限，若无，则返回没有权限的错误，若有，则打开表继续执行。打开表的时候，执行器就会根据表的引擎定义，去使用这个引擎提供的接口。

   存储引擎：数据的存储和提取，提供读写接口。

2. Server层和存储引擎层各是什么作用？

   Server 层包括连接器 、分析器、优化器、执行器等，涵盖 MySQL 的大多数核心服务功能，以及所有的内置函数（如日期、时间、数学和加密函数等），所有跨存储引擎的功能都在这一层实现，比如存储过程、触发器、视图等。

   存储引擎层主要负责数据的存储和提取，其架构模式是插件式的，支持InnoDB、MyISAM、Memory等各种存储引擎。

3. you have an error in your SQL syntax 这个保存是在词法分析里还是在语法分析里报错？

   语法分析

4. 对于表的操作权限验证在哪里进行？

   是在执行器执行阶段进行的

5. 执行器的执行查询语句的流程是什么样的？

   假设语句如下所示，引擎是InnoDB：

   ```mysql
   
   mysql> select * from T where ID=10;
   
   ERROR 1142 (42000): SELECT command denied to user 'b'@'localhost' for table 'T'
   ```

   执行器的执行流程:

   1. 调用InnoDB引擎接口获取表的第一行，判断ID是不是10，如果不是，则跳过，否则，将其存在结果集中。
   2. 调用引擎接口获取下一行，重复相同的逻辑判断，直至取到表的最后一行。
   3. 执行器将上述遍历过程中所有满足条件的行组成的记录集作为结果集返回给客户端。

## 02 日志系统：一条SQL更新语句是如何执行的？

